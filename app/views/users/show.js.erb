console.log("<%= params[:type].present? %>");
sortableCollaborationUsers($('.sort_c_users'));
<% if params[:type].present? %>
      var $list = $('[data-list-id = "<%= current_list.id %>"]');
      var $listUsers = $('#list-users .sort_c_users',$list);
      var $collaboration_user = $('#collaboration-users li#collaboration_user_<%= @user.id %>',$list);
      var $user = $('[data-user-id = "<%= @user.id %>"]',$list),
          tooltip = $("a.tooltipped", $collaboration_user).data("tooltip"),
          text, $elem;
      if ($collaboration_user.hasClass('active')) {
          $collaboration_user.removeClass('active');
          text = tooltip.replace("Hide", "Show");
          $("a.tooltipped", $collaboration_user).attr("data-tooltip",text);
          $('.tooltipped').tooltip({delay: 50});
          $user.remove();
        } else {
          $collaboration_user.addClass('active');
          text = tooltip.replace("Show", "Hide");

          var sortedIDs = $("#collaboration-users").sortable("toArray");
          $("a.tooltipped", $collaboration_user).attr("data-tooltip",text);
          var position = $.inArray( "collaboration_user_<%= @user.id %>", sortedIDs );

          if ($("#list-users > ul.sort_c_users").children("li:eq(" + position + ")").length >0){
            $("<%= j render partial: 'users/list_user', locals:{user: @user, list: current_list } %>").insertBefore($("#list-users > ul.sort_c_users").children("li:eq(" + position + ")"));
          }else{
              // console.log("<%= j render partial: 'users/list_user', locals:{user: @user, list: current_list } %>");
              $("#list-users > ul.sort_c_users").append("<%= j render partial: 'users/list_user', locals:{user: @user, list: current_list } %>");
          }

           //$listUsers.append("<%= j render partial: 'users/list_user', locals:{user: @user, list: current_list } %>");
          $elem = $("#list_user_<%= @user.id %>");

          if ($elem.length > 0){
            myDroppable_task_to_user($elem);
          }
          $('input[id="task_user_id"]',$user).val("<%= @user.id %>");
          $('.tooltipped').tooltip({delay: 50});
          msCollapsible("collapsible");
          $('div[id^="incomplete_tasks_"]').each(function (){
            mySortable($(this));
          })

          droppable_all('li[id^="drop_zone_"]');
          $('.edit_task').submitOnCheck();
          deadlineDatepicker($('input.deadline-datepicker'));
          $('input.deadline-datepicker.hidden-datepicker').hover(handlerIn, handlerOut);
       }
<% end %>
