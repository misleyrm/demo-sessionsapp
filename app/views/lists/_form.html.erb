<%= form_for(@list, url: (@list.new_record?) ? "/lists" : list_url(@list), method: :post, :html=>{id: "list-new",remote: true}, :data => {new: (@list.new_record?)? "create" : "update"}) do |f| %>
      <%= hidden_field_tag 'id', @list.id%>
      <%= render :partial => 'shared/error_messages', :locals => {:object => @list} %>
      <input type='hidden' name='_method' value="<%=(@list.new_record?) ? "post" : "put"%>">
      <%= content_tag "div", id: "flash_message" do%>
        <%= render 'shared/flash_messages' if !flash.empty? %>
      <% end %>
      <%= content_tag "div", id: "error_message_list" do%>
         <%= render :partial => 'shared/error_messages', :locals => {:object => @list} %>
      <% end %>
      <% if ((!@list.new_record?) && @list.all_tasks_list?) %>
          <div class="valign-wrapper ms-avatar-all-task">
              <i class="material-icons">list</i>
          </div>
      <% else %>
          <div class="valign-wrapper ms-upload-avatar" style="<% if ((!@list.new_record?) && @list.avatar?) %> background-image: url('<%= @list.avatar('thumb') %>');<% end %>">
                <%= f.file_field :avatar %>
                <label for="list_avatar">
                  <% if ((!@list.new_record?) && (!@list.avatar?)) %>
                      <span class="ms-avatar-ini show"><%= @list.name[0]%></span>
                  <% end %>
                  <div class="mousehover <%= (@list.new_record?)? 'hover': 'active' %> ">
                      <i class="material-icons">camera_alt</i><%= (@list.new_record?)? "Upload": "Change" %> your Avatar
                  </div>
                </label>
          </div>
      <% end %>
      <div class="row">
          <div class="col s12">
              <div class="input-field">
                  <%= f.text_field :name ,id: "list_name", disabled: @list.all_tasks_list?%>
                  <%= f.label :name,class: (@list.new_record?)? '': 'active' %>
              </div>
          </div>
          <div class="divider col s12"></div>
          <div class="col s12">
              <div class="input-field">
                  <%= f.text_area :description,class:'materialize-textarea', id: 'list_description' %>
                  <%= f.label :description, class: (@list.new_record?)? '': 'active' %>
              </div>
         </div>
         <div class="divider col s12"></div>
      </div>
      <!-- Change Ownership -->

          <!-- new -->
          <ul class="collapsible ms-accordion-section" data-collapsible="accordion" id="change_ownership">
            <li>
              <div class="collapsible-header">
                <div class="ms-form-title"><span class="uppercase">Transfer Ownership</span>
                    <i class="material-icons right ms-open-button">keyboard_arrow_right</i>
                </div>
                <p class="details"><i class="material-icons prefix">warning</i><span>Trasfer ownership of this account to another user.</span></p>
              </div>
              <div class="collapsible-body" id="user_ownership_change">
                    <div id="errors">
                        <%= render partial: "shared/flash_messages", locals: {list: @list} %>
                    </div>
                    <%= f.hidden_field :id, :value => @list.id %>
                    <p class="md-red">You will no longer be able to manage this list setting.</p>
                    <div class="input-field">
                      <select name="list_owner" id="list_owner" data-list-owner= "<%= @list.user_id %>">
                          <option value= "<%= @list.user_id %>" <%= (current_user.owner?(@list))? "selected" : "" %>><%= @list.owner_name %></option>
                          <% @list.collaboration_users.each do |collaborator_user| %>
                             <% if collaborator_user.active_collaborator?(@list.id) %>
                                <option value="<%= collaborator_user.id %>"><%= collaborator_user.name %></option>
                              <% end %>
                          <% end %>
                      </select>
                    </div>
                    <div class="input-field ms-explanation">
                      <%= password_field_tag(:current_password, "", placeholder: "Current Password",id: "change_ownership_password", :options => {:autocomplete => 'off'}) %>
                      <span>Enter your password to confirm that you want to transfer list ownership.</span>
                    </div>
                    <div class="row ms-button">
                        <div class="col s6 left">
                          <div class="input-field center-align">
                             <a class= "waves-effect waves-light btn-medium lowercase su-btn btn-flat col s12 btn-gray btn-cancel">Cancel</a>
                          </div>
                        </div>
                        <div class="col s6 right">
                          <div class="input-field center-align">
                            <%= link_to  "", data: { src: updateOwnership_list_path(@list) }, id: "btn-list-ownership-change",class: "waves-effect waves-light btn-medium lowercase su-btn btn-flat col s12 disabled", remote: true do %>
                                 Transfer Ownership
                            <% end %>
                          </div>
                        </div>
                      </div>
              </div>
            </li>
          </ul>
          <div class="divider col s12"></div>
          <!-- end new -->
         <!-- <div class="col s12">
              <div class="input-field">
                <% if (@list.new_record?||@list.all_tasks_list?)||(!current_user.owner?(@list)) %>
                    <%= text_field_tag 'owner', (!current_user.owner?(@list))? "#{@list.owner_name}" : "#{current_user.name} ",id: 'list_owner1',  disabled: true %>
                    <%= f.label :owner, :class => "active" %>
                <% elsif %>
                    <p class="uppercase label">List Owner</p>
                    <select name="list_owner" id="list_owner2">
                        <option value= "<%= @list.user_id %>" <%= (current_user.owner?(@list))? "selected" : "" %>><%= @list.owner_name %></option>
                        <% @list.collaboration_users.each do |collaborator_user| %>
                           <option value="<%= collaborator_user.id %>" <%= (collaborator_user.owner?(@list))? "selected" : "" %>><%= collaborator_user.name %></option>
                        <% end %>
                    </select>
                <% end %>
              </div>
          </div> -->
          <!-- End of Change Ownership -->


    <% unless (@list.new_record?||@list.all_tasks_list?||!current_user.owner?(@list)) %>
          <div class="row" >
              <ul class="tabs my-tabs">
                <li class="tab my-tab nav-link uppercase label"><a href="#collaborators" class="active">Collaborators</a></li>
                <li class="tab my-tab nav-link uppercase label"><a href="#invitations">Pending Invitations</a></li>
              </ul>
              <div class="my-tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="collaborators">
                  <ul class="collaboration-user-settings">
                    <% if (!current_user.owner?(@list) && (!@list.owner.nil?)) %>
                       <%= render partial: "lists/collaboration_user_settings", locals: {list: @list,collaboration_user: @list.owner} %>
                    <% end %>
                    <% if  @list.collaboration_users.where(['user_id != ?', current_user.id]).count > 0 %>
                       <%= render partial: "lists/collaboration_user_settings", collection: @list.collaboration_users, as: :collaboration_user, :locals => {:list => @list}   %>
                    <% end %>
                    <!-- <li class="more"><i class="material-icons">more_vert</i></li> -->
                    <% if (current_user.owner?(@list))%>
                       <li class="right ms-add">
                          <%= link_to new_list_invitation_path(@list),id: 'new_invitation_link',class:"btn-floating btn-my-medium",data: {behavior: 'modal', tooltip: 'Invite a new member',remote: true} do%>
                                <i class="material-icons md-18 md-dark md-inactive">add</i>  <span>Invite</span>
                          <% end %>
                        </li>
                    <% end %>
                  </ul>
                </div>
                <div class="tab-pane fade show" id="invitations">
                  <ul class="invitation-user-settings">
                    <% if  @pending_invitations.count > 0 %>
                       <%= render partial: "lists/invited_user", collection: @pending_invitations, as: :invited_user, locals: {"list": @list} %>
                    <% end %>
                  </ul>
                </div>
              </div>
          </div>
          <div class="divider col s12"></div>
  			  <div class="row">
      				<!-- <div class="col s6"> -->
                  <!-- <div class="input-field center-align">
                    <a class='waves-effect waves-light btn-medium submit lowercase su-btn btn-flat col s12 white disabled'>Transfer Ownership</a>
                  </div> -->
      				<!-- </div> -->
              <div class="col s12">
                <div class="input-field center-align">
                  <%= link_to 'Delete list',@list, method: :delete, data: {confirm: "Are you sure you want to delete it?"}, class: 'waves-effect waves-light btn-delete lowercase btn-medium su-btn btn-flat submit col s12', remote: true  %>
                </div>
              </div>
          </div>
      <% end %>
      <div class="row">
          <div class="col s6">
            <div class="input-field center-align">  <!--$('#modal1').modal('close');-->
              <a href="#!" class="modal-action waves-effect waves-light btn btn-medium lowercase su-btn btn-flat submit col s12" >Cancel</a>
            </div>
          </div>
          <div class="col s6">
            <div class="input-field center-align">
              <a class="waves-effect waves-light btn btn-medium submit su-btn btn-flat lowercase col s12" id="btn-list-form-submit"><%= (@list.new_record?)? ( f.submit "Create" ): ( f.submit "Save" ) %></a>
            </div>
          </div>
        </div>
<% end %>
