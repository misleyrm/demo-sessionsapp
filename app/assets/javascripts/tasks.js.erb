document.addEventListener("turbolinks:load", function(){

    // deadlineDatepicker();
    $("i.i-btn-datepicker").on('click', function(){
       $(this).siblings(".hidden-datepicker").focus();
    })

    $( ".show_blockers ul" ).mouseenter(function(){
        // $( this ).css("background-color","red");
      })
      .mouseleave( function() {
        // $( this ).css("background-color","white");
      })

    $('div[id^="incomplete_tasks_"]').each(function (){
      mySortable($(this));
    })

    $('li[id^="drop_zone_"]').each(function (e){
      myDroppable($(this));


    })

});

function mySortable(elem){
 if (elem.is(':visible')){
  elem.sortable({
    update: function(e,ui){
      // send the updated order via ajax
      console.log("1");
       $.ajax({
           type: "PUT",
           url: $(this).data("url"),
           data: $(this).sortable('serialize'),
       });
    }
  });
  }
}


function myDroppable(elem){
    elem.droppable({
        hoverClass: 'ui-state-active',
        tolerance: 'pointer',
        disable:elem.hasClass("active")? 'true':'false',
        accept: function (event, ui) {
            return true;
        },
        drop: function (event, ui) {
            var obj;
            if ($(ui.helper).hasClass('draggable')) {
                ui.draggable.css( "color", "red" )
                console.log(ui.draggable);
                var taskId = ui.draggable.data("task-id"),
                    currentlistId = ui.draggable.parents("div#current-list").data("list-id"),
                    listId = elem.data("nav-list-id"),
                    url = "/tasks/"+ taskId +"/changelist?currentList="+ currentlistId +"&list_id="+listId;
                ui.draggable.remove();    
                $.ajax({
                    type: "patch",
                    url: url,
                    data: "",
                });
            }
        }
    })
}
